var React=window.React,ReactDOM=window.ReactDOM;

(()=>{const{useState:i,useEffect:D}=React;function re(){const[t,s]=i(null),[m,a]=i(!1),[p,n]=i(null),[y,b]=i(!1),[k,v]=i(null),u=React.useRef(null);D(()=>{var d;const e=sessionStorage.getItem("connectedAddress");e&&s(e),window.IS_SAFE_APP&&((d=window.SAFE_INFO)!=null&&d.safeAddress)&&(s(window.SAFE_INFO.safeAddress),b(!0),v("safe"))},[]),D(()=>{t&&sessionStorage.setItem("connectedAddress",t),window.CONNECTED_ADDRESS=t||null,window.dispatchEvent(new CustomEvent("wallet:changed",{detail:{address:t}}))},[t]);async function f(e,d){try{if(!e||!d)return b(!1);const o=await d.request({method:"eth_getCode",params:[e,"latest"]});b(o&&o!=="0x")}catch(o){b(!1)}}async function g(){const e=()=>{const o=window["@walletconnect/ethereum-provider"];if(o){const l=o.EthereumProvider||o.default||o;if(l&&typeof l.init=="function")return{init:C=>l.init(C)}}};if(window.WalletConnectEthereumProvider&&typeof window.WalletConnectEthereumProvider.init=="function")return window.WalletConnectEthereumProvider;let d=e();if(d)return d;await new Promise(o=>{if(document.getElementById("wc-eth-provider-cdn"))return o();const l=document.createElement("script");l.id="wc-eth-provider-cdn",l.src="https://unpkg.com/@walletconnect/ethereum-provider@2.11.1/dist/index.umd.js",l.async=!0,l.onload=o,l.onerror=o,document.head.appendChild(l)});for(let o=0;o<10;o++){if(window.WalletConnectEthereumProvider&&typeof window.WalletConnectEthereumProvider.init=="function")return window.WalletConnectEthereumProvider;if(d=e(),d)return d;await new Promise(l=>setTimeout(l,100))}}function x(){try{const e=[/walletconnect/i,/wc@2/i,/WALLETCONNECT/i],d=Object.keys(localStorage||{});for(const l of d)e.some(C=>C.test(l))&&localStorage.removeItem(l);const o=Object.keys(sessionStorage||{});for(const l of o)e.some(C=>C.test(l))&&sessionStorage.removeItem(l)}catch(e){}}async function P(){const e=window.WC_PROJECT_ID||window.ENV&&window.ENV.WC_PROJECT_ID;if(!e){n("Missing WalletConnect projectId. Set window.WC_PROJECT_ID.");return}const d=await g();if(!d||!d.init){n("WalletConnect provider not loaded");return}a(!0),n(null);try{x();const o=await d.init({projectId:e,showQrModal:!0,chains:[1],optionalChains:[137,44787,42220],metadata:{name:"Moeda Maker",description:"Bank-backed tokens and WhatsApp onboarding",url:location&&location.origin||"http://localhost",icons:["https://walletconnect.com/walletconnect-logo.png"]}});let l=[];try{l=await o.enable()}catch(q){l=await o.request({method:"eth_requestAccounts"})}const C=l==null?void 0:l[0];s(C),await f(C,o),u.current=o,v("walletconnect");try{o.on&&o.on("disconnect",()=>N())}catch(q){}}catch(o){n((o==null?void 0:o.message)||"WalletConnect failed")}finally{a(!1)}}async function w(){const e=window.ethereum;if(!e){n("No browser wallet found");return}a(!0),n(null);try{try{await e.request({method:"wallet_revokePermissions",params:[{eth_accounts:{}}]})}catch(l){}try{await e.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]})}catch(l){}const d=await e.request({method:"eth_requestAccounts"}),o=d==null?void 0:d[0];s(o),await f(o,e),u.current=e,v("browser");try{e.on&&e.on("accountsChanged",l=>{const C=l&&l[0];C?s(C):N()}),e.on&&e.on("disconnect",()=>N())}catch(l){}}catch(d){n((d==null?void 0:d.message)||"Browser wallet connect failed")}finally{a(!1)}}async function N(){try{const e=u.current;if(e&&typeof e.disconnect=="function")try{await e.disconnect()}catch(d){}if(e&&typeof e.disconnectSession=="function")try{await e.disconnectSession()}catch(d){}try{k==="browser"&&e&&typeof e.request=="function"&&await e.request({method:"wallet_revokePermissions",params:[{eth_accounts:{}}]})}catch(d){}try{e&&e.removeListener&&e.removeListener("accountsChanged",()=>{})}catch(d){}try{e&&e.removeListener&&e.removeListener("disconnect",()=>{})}catch(d){}}catch(e){}x(),u.current=null,v(null),b(!1),s(null),sessionStorage.removeItem("connectedAddress"),sessionStorage.removeItem("preferredProviderUUID"),window.CONNECTED_ADDRESS=null,window.dispatchEvent(new CustomEvent("wallet:changed",{detail:{address:null}}))}return t?React.createElement("div",{className:"flex items-center gap-2"},React.createElement("span",{className:`px-2 py-1 rounded text-xs ${y?"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200"}`,title:window.IS_SAFE_APP?"Safe App (multisig)":y?"This looks like a contract wallet (e.g., multisig)":"EOA"},window.IS_SAFE_APP?"Safe":y?"Contract":"EOA"),React.createElement("span",{className:"text-xs font-mono"},t.slice(0,6),"\u2026",t.slice(-4)),!window.IS_SAFE_APP&&React.createElement("button",{onClick:N,className:"ml-2 px-2 py-1 rounded bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-xs hover:bg-slate-300 dark:hover:bg-slate-600"},"Disconnect")):React.createElement("div",{className:"flex items-center gap-2"},!window.IS_SAFE_APP&&React.createElement("button",{onClick:w,disabled:m,className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs hover:bg-blue-700 shadow"},m?"Connecting\u2026":"Connect Multisig"),window.IS_SAFE_APP&&React.createElement("span",{className:"text-xs text-green-600"},"Safe App detected"),p&&React.createElement("span",{className:"text-xs text-red-600 dark:text-red-300"},p))}const X=({label:t,icon:s,active:m,onClick:a})=>React.createElement("button",{onClick:a,className:`flex items-center w-full px-3 py-2 rounded-lg text-sm transition shadow-sm ${m?"bg-blue-600 text-white":"text-slate-700 dark:text-slate-200 hover:bg-slate-100/70 dark:hover:bg-slate-800/50"}`},React.createElement("span",{className:"mr-2"},s),t);function oe(){const[t,s]=i("dashboard"),[m,a]=i(null);return D(()=>{if(!m)return;const p=setTimeout(()=>a(null),3e3);return()=>clearTimeout(p)},[m]),React.createElement("div",{className:"min-h-screen"},React.createElement("div",{className:"relative overflow-hidden"},React.createElement("div",{className:"absolute inset-0 -z-10 opacity-60 dark:opacity-30"},React.createElement("div",{className:"absolute -top-24 -left-24 h-72 w-72 rounded-full bg-blue-300/30 blur-3xl"}),React.createElement("div",{className:"absolute -bottom-24 -right-24 h-72 w-72 rounded-full bg-emerald-300/30 blur-3xl"})),React.createElement("header",{className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border-b border-white/40 dark:border-slate-800"},React.createElement("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between"},React.createElement("div",{className:"flex items-center gap-3"},React.createElement("div",{className:"w-9 h-9 rounded-xl bg-gradient-to-br from-blue-600 to-emerald-500 text-white grid place-items-center font-semibold shadow"},"PC"),React.createElement("div",null,React.createElement("h1",{className:"font-semibold text-slate-900 dark:text-slate-100"},"Moeda Maker"),React.createElement("p",{className:"text-xs text-slate-500 dark:text-slate-400"},"Bank-backed tokens \u2022 WhatsApp onboarding"))),React.createElement("div",{className:"flex items-center gap-3"},React.createElement(re,null),React.createElement("div",{className:"hidden sm:flex items-center text-xs text-green-600"},React.createElement("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Online"))))),React.createElement("div",{className:"max-w-7xl mx-auto px-4 py-6 grid grid-cols-12 gap-6"},React.createElement("aside",{className:"col-span-12 md:col-span-3 lg:col-span-2"},React.createElement("div",{className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-2 space-y-1 shadow-sm"},React.createElement(X,{label:"Dashboard",icon:"\u{1F3E0}",active:t==="dashboard",onClick:()=>s("dashboard")}),React.createElement(X,{label:"Make Moeda",icon:"\u{1F680}",active:t==="deploy",onClick:()=>s("deploy")}),React.createElement(X,{label:"Bank Connect",icon:"\u{1F3E6}",active:t==="bank",onClick:()=>s("bank")}),React.createElement("button",{onClick:()=>s("setup"),className:"flex items-center w-full px-3 py-2 rounded-lg text-sm transition shadow-sm text-slate-700 dark:text-slate-200 hover:bg-slate-100/70 dark:hover:bg-slate-800/50"},React.createElement("span",{className:"mr-2"},"\u{1F4F1}"),"Account Setup")),m&&React.createElement("div",{className:"mt-4 p-3 rounded-lg text-sm border border-blue-200/60 bg-blue-50/70 text-blue-800 dark:text-blue-200 dark:bg-blue-900/20 dark:border-blue-800"},m)),React.createElement("main",{className:"col-span-12 md:col-span-9 lg:col-span-10 space-y-6"},t==="dashboard"&&React.createElement(le,null),t==="deploy"&&React.createElement(de,{onNotice:a}),t==="bank"&&React.createElement(ce,{onNotice:a}),t==="setup"&&React.createElement(ie,{onNotice:a}))))}function $({label:t,value:s,sub:m}){return React.createElement("div",{className:"p-4 backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl shadow-sm"},React.createElement("div",{className:"text-xs uppercase text-slate-500 dark:text-slate-400"},t),React.createElement("div",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100 mt-1"},s),m&&React.createElement("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1"},m))}function le(){var b,k;const[t,s]=i(null),[m,a]=i(!1),[p,n]=i(null),y=async()=>{var v,u;a(!0),n(null);try{const{data:f}=await axios.get("/health");s(f)}catch(f){const g=typeof axios!="undefined"&&axios.defaults&&axios.defaults.baseURL?axios.defaults.baseURL:"",x=typeof location!="undefined"&&(!g||g===location.origin),P=typeof location!="undefined"&&/github\.io$/i.test(location.hostname);n(P&&x?null:((u=(v=f==null?void 0:f.response)==null?void 0:v.data)==null?void 0:u.error)||f.message)}finally{a(!1)}};return D(()=>{y()},[]),React.createElement("div",{className:"space-y-6"},React.createElement("div",{className:"flex items-center justify-between"},React.createElement("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight text-slate-900 dark:text-white drop-shadow-sm"},"Overview"),React.createElement("button",{onClick:y,className:"px-3 py-1.5 text-sm rounded-md bg-slate-900 text-white hover:bg-slate-800"},"Refresh")),p&&React.createElement("div",{className:"p-3 rounded-lg border border-red-200/60 bg-red-50/70 text-red-700 dark:bg-red-900/20 dark:text-red-200 dark:border-red-800 text-sm"},p),!t&&!m&&typeof window!="undefined"&&/github\.io$/i.test(window.location.hostname)&&(!window.API_BASE||window.API_BASE==="")&&React.createElement("div",{className:"p-3 rounded-lg border border-amber-200/60 bg-amber-50/70 text-amber-800 dark:bg-amber-900/20 dark:text-amber-200 dark:border-amber-800 text-sm"},"API not configured for GitHub Pages. Set window.API_BASE in public/env.js to your backend URL."),React.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},React.createElement($,{label:"API",value:t?"Healthy":m?"Loading\u2026":"Unknown",sub:"/health"}),React.createElement($,{label:"WhatsApp",value:(b=t==null?void 0:t.services)!=null&&b.whatsapp?"Active":"Disabled"}),React.createElement($,{label:"Pluggy",value:(k=t==null?void 0:t.services)!=null&&k.pluggy?"Active":"Disabled"}),React.createElement($,{label:"Network",value:window.location.origin})),React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6"},React.createElement("div",{className:"p-5 backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl shadow-sm"},React.createElement("h3",{className:"font-medium text-slate-900 dark:text-slate-100"},"Quick Start"),React.createElement("ol",{className:"mt-3 text-sm text-slate-600 dark:text-slate-300 list-decimal list-inside space-y-1"},React.createElement("li",null,"Deploy a token"),React.createElement("li",null,"Connect a bank account"),React.createElement("li",null,"Mint within bank backing limits"))),React.createElement("div",{className:"p-5 backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl shadow-sm"},React.createElement("h3",{className:"font-medium text-slate-900 dark:text-slate-100"},"Helpful Links"),React.createElement("ul",{className:"mt-3 text-sm text-blue-700 dark:text-blue-300 space-y-1"},React.createElement("li",null,React.createElement("a",{className:"hover:underline",href:"/",target:"_blank"},"Root")),React.createElement("li",null,React.createElement("a",{className:"hover:underline",href:"https://github.com/TerexitariusStomp/BrazilCommunityCurrency#readme",target:"_blank",rel:"noreferrer"},"README (GitHub)"))))))}function de({onNotice:t}){var M,j,K,B,Y,J;const[s,m]=i({masterMinter:"",pauser:"",blacklister:"",owner:""}),[a,p]=i(!1),[n,y]=i(null),[b,k]=i(null),[v,u]=i(!!window.CONNECTED_ADDRESS),[f,g]=i(!1),[x,P]=i(!1),[w,N]=i("celoSepolia"),e=React.useRef(null),d=React.useRef(null),o={celo:{chainId:"0xa4ec",chainName:"Celo Mainnet",nativeCurrency:{name:"CELO",symbol:"CELO",decimals:18},rpcUrls:["https://forno.celo.org","https://rpc.ankr.com/celo"],blockExplorerUrls:["https://celoscan.io","https://explorer.celo.org/mainnet"]},celoSepolia:{chainId:"0xaa044c",chainName:"Celo Sepolia Testnet",nativeCurrency:{name:"CELO",symbol:"CELO",decimals:18},rpcUrls:["https://forno.celo-sepolia.celo-testnet.org"],blockExplorerUrls:["https://celo-sepolia.blockscout.com"]}};async function l(h){try{if(!window.ethereum||window.IS_SAFE_APP)return!0;const c=o[h];return c&&await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:c.chainId}]}),!0}catch(c){if(c&&(c.code===4902||c.code===-32603))try{const r=o[h];return await window.ethereum.request({method:"wallet_addEthereumChain",params:[r]}),await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:r.chainId}]}),!0}catch(r){return k((r==null?void 0:r.message)||"Failed to add/switch network"),!1}return k((c==null?void 0:c.message)||"Failed to switch network"),!1}}const C=[{inputs:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"symbol",type:"string"},{internalType:"address",name:"masterMinter",type:"address"},{internalType:"address",name:"pauser",type:"address"},{internalType:"address",name:"blacklister",type:"address"},{internalType:"address",name:"owner",type:"address"}],name:"deployToken",outputs:[{internalType:"address",name:"tokenProxy",type:"address"},{internalType:"address",name:"implementation",type:"address"}],stateMutability:"nonpayable",type:"function"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"token",type:"address"},{indexed:!0,internalType:"address",name:"proxy",type:"address"},{indexed:!0,internalType:"address",name:"deployer",type:"address"},{indexed:!1,internalType:"string",name:"name",type:"string"},{indexed:!1,internalType:"string",name:"symbol",type:"string"}],name:"TokenDeployed",type:"event"}];async function q(h,c,r){var z,G,U,Q;if(!window.ethereum||!window.ethers)throw new Error("No wallet available");const E=w==="celo"?window.CELO_FACTORY_ADDRESS||"":window.CELO_SEPOLIA_FACTORY_ADDRESS||"";if(!E)throw new Error("Factory address not configured for selected network");const _=await new window.ethers.BrowserProvider(window.ethereum).getSigner(),R=await(await new window.ethers.Contract(E,C,_).deployToken(h,c,r.masterMinter,r.pauser,r.blacklister,r.owner)).wait(),I=new window.ethers.Interface(C);let S,W;for(const ne of R.logs||[])try{const O=I.parseLog(ne);if(O&&O.name==="TokenDeployed"){S=O.args.token,W=O.args.proxy;break}}catch(O){}return{proxy:S||((G=(z=R.logs)==null?void 0:z[0])==null?void 0:G.address)||null,implementation:W||null,txHash:R.hash,gasUsed:((Q=(U=R.gasUsed)==null?void 0:U.toString)==null?void 0:Q.call(U))||"0"}}const ee=[{inputs:[{internalType:"address",name:"token",type:"address"}],name:"getBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],te=[{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"}];async function H(h){if(!window.ethers||!window.ORACLE_ADDRESS||!h)return null;try{const c=new window.ethers.BrowserProvider(window.ethereum),r=new window.ethers.Contract(window.ORACLE_ADDRESS,ee,c),E=new window.ethers.Contract(h,te,c),[A,_,F]=await Promise.all([r.getBalance(h),E.totalSupply(),E.decimals()]),T=window.ethers.toNumber(F),R=Number(A)/10**2,I=Number(_)/10**T,S=I>0?R/I:null;return{backing:R,supply:I,ratio:S}}catch(c){return null}}D(()=>{const h=c=>{var E;const r=(E=c==null?void 0:c.detail)==null?void 0:E.address;u(!!r),r&&m(A=>({...A,masterMinter:r,pauser:r,blacklister:r,owner:r}))};return window.addEventListener("wallet:changed",h),window.CONNECTED_ADDRESS&&h({detail:{address:window.CONNECTED_ADDRESS}}),()=>window.removeEventListener("wallet:changed",h)},[]);const ae=async h=>{var c,r,E,A;h.preventDefault(),p(!0),k(null),y(null);try{if(!window.ethereum)throw new Error("Connect your wallet first");if(!await l(w)){p(!1);return}const F=((c=e.current)==null?void 0:c.value)||"",T=((r=d.current)==null?void 0:r.value)||"",R={...s};if(!(w==="celo"?window.CELO_FACTORY_ADDRESS||"":window.CELO_SEPOLIA_FACTORY_ADDRESS||""))throw new Error("Factory address not configured for selected network");const S=await q(F,T,R);y(S);try{S.backing=await H(S.proxy)}catch(W){}try{window.ethereum&&S.proxy&&await window.ethereum.request({method:"wallet_watchAsset",params:{type:"ERC20",options:{address:S.proxy,symbol:(T||"").slice(0,11)||"TOKEN",decimals:6,image:void 0}}})}catch(W){}t==null||t("On-chain deployment sent and confirmed.")}catch(_){k(((A=(E=_==null?void 0:_.response)==null?void 0:E.data)==null?void 0:A.error)||_.message)}finally{p(!1)}},se=async()=>{var h,c;try{const{data:r}=await axios.post(`/api/connect-bank/${n.proxy}`,{network:w});r!=null&&r.connectUrl&&window.open(r.connectUrl,"_blank")}catch(r){alert(((c=(h=r==null?void 0:r.response)==null?void 0:h.data)==null?void 0:c.error)||r.message)}},L=({label:h,name:c,placeholder:r})=>React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-600 dark:text-slate-300 mb-1"},h),React.createElement("input",{type:"text",autoComplete:"off",onChange:E=>m(A=>({...A,[c]:E.target.value})),placeholder:r,value:s[c]||"",className:"w-full rounded-md px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}));return React.createElement("div",{className:"space-y-4"},React.createElement("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight text-slate-900 dark:text-white drop-shadow-sm"},"make a new moeda"),React.createElement("form",{onSubmit:ae,className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-5 space-y-4 shadow-sm"},React.createElement("div",{className:"rounded-md p-3 text-sm border border-amber-200/60 bg-amber-50/70 text-amber-800 dark:text-amber-200 dark:bg-amber-900/20 dark:border-amber-800"},"Connect your multisig (Safe) wallet to create the community currency. If you connect a personal wallet instead for deployment, paste your multisig address into the role fields below so the multisig controls the token."),React.createElement("div",{className:"flex items-center gap-2 text-xs"},React.createElement("span",{className:"text-slate-600 dark:text-slate-300"},"Select Network:"),React.createElement("button",{type:"button",onClick:async()=>{N("celoSepolia"),await l("celoSepolia")},className:`px-2 py-1 rounded border ${w==="celoSepolia"?"bg-emerald-600 text-white border-emerald-700":"bg-white/70 dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-300 dark:border-slate-700"}`},"Celo Testnet (Sepolia)"),React.createElement("button",{type:"button",onClick:async()=>{N("celo"),await l("celo")},className:`px-2 py-1 rounded border ${w==="celo"?"bg-emerald-600 text-white border-emerald-700":"bg-white/70 dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-300 dark:border-slate-700"}`},"Celo Mainnet")),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-600 dark:text-slate-300 mb-1"},"Token Name"),React.createElement("input",{ref:e,type:"text",autoComplete:"off",placeholder:"Community Real",onInput:h=>g(!!h.target.value.trim()),className:"w-full rounded-md px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})),React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-600 dark:text-slate-300 mb-1"},"Symbol"),React.createElement("input",{ref:d,type:"text",autoComplete:"off",placeholder:"CREAL",onInput:h=>P(!!h.target.value.trim()),className:"w-full rounded-md px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})),React.createElement(L,{label:"Master Minter (multisig)",name:"masterMinter",placeholder:"0x multisig address"}),React.createElement(L,{label:"Pauser (multisig)",name:"pauser",placeholder:"0x multisig address"}),React.createElement(L,{label:"Blacklister (multisig)",name:"blacklister",placeholder:"0x multisig address"}),React.createElement(L,{label:"Owner (multisig)",name:"owner",placeholder:"0x multisig address"})),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("button",{disabled:a||!v||!f||!x,title:v?f?x?"":"Enter token symbol":"Enter token name":"Connect wallet",className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-emerald-500 text-white text-sm hover:opacity-95 disabled:opacity-50 shadow"},a?"Making\u2026":"Make Moeda"),b&&React.createElement("span",{className:"text-sm text-red-600 dark:text-red-300"},b))),n&&React.createElement("div",{className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-5 shadow-sm"},React.createElement("h3",{className:"font-medium text-slate-900 mb-2"},"Moeda Created"),React.createElement("div",{className:"text-sm text-slate-700 dark:text-slate-200 space-y-1"},React.createElement("div",null,React.createElement("span",{className:"text-slate-500 dark:text-slate-400"},"Stablecoin (Token Address):")," ",n.proxy),React.createElement("div",null,React.createElement("span",{className:"text-slate-500 dark:text-slate-400"},"Implementation (legacy):")," ",n.implementation),React.createElement("div",null,React.createElement("span",{className:"text-slate-500 dark:text-slate-400"},"Transaction Hash:")," ",n.txHash),window.ORACLE_ADDRESS&&React.createElement("div",{className:"mt-2"},React.createElement("button",{onClick:async()=>{const h=await H(n.proxy);y(c=>({...c,backing:h}))},className:"px-2 py-1 text-xs rounded bg-slate-200 dark:bg-slate-700"},"Refresh Backing"),n.backing&&React.createElement("div",{className:"mt-2 text-xs text-slate-600 dark:text-slate-300"},"Backing: ",(K=(j=(M=n.backing.backing)==null?void 0:M.toLocaleString)==null?void 0:j.call(M))!=null?K:"-"," | Supply: ",(J=(Y=(B=n.backing.supply)==null?void 0:B.toLocaleString)==null?void 0:Y.call(B))!=null?J:"-"," | Ratio: ",n.backing.ratio?(n.backing.ratio*100).toFixed(2)+"%":"-"))),React.createElement("button",{onClick:se,className:"mt-4 px-3 py-2 rounded-lg bg-emerald-600 text-white text-sm hover:bg-emerald-700 shadow"},"Connect Bank Account")))}function ie({onNotice:t}){const[s,m]=React.useState(""),[a,p]=React.useState(!1),[n,y]=React.useState(""),[b,k]=React.useState(null);return React.createElement("div",{className:"space-y-6"},React.createElement("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight text-slate-900 dark:text-white drop-shadow-sm"},"Account Setup"),React.createElement("form",{onSubmit:async u=>{var f,g;u.preventDefault(),p(!0),k(null),y("");try{if(!s)throw new Error("Enter your WhatsApp phone e.g. +55...");await axios.post("/api/whatsapp/register",{phone:s}),y("WhatsApp linked successfully."),t==null||t("WhatsApp linked")}catch(x){k(((g=(f=x==null?void 0:x.response)==null?void 0:f.data)==null?void 0:g.error)||x.message)}finally{p(!1)}},className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-5 space-y-4 shadow-sm"},React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-600 dark:text-slate-300 mb-1"},"Your WhatsApp (phone)"),React.createElement("input",{value:s,onChange:u=>m(u.target.value),placeholder:"+55...",className:"w-full rounded-md px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("button",{disabled:a,className:"px-4 py-2 rounded-lg bg-emerald-600 text-white text-sm hover:bg-emerald-700 disabled:opacity-50 shadow"},a?"Saving...":"Save"),b&&React.createElement("span",{className:"text-sm text-red-600 dark:text-red-300"},b),n&&React.createElement("span",{className:"text-sm text-green-700 dark:text-green-300"},n)),React.createElement("p",{className:"text-xs text-slate-500"},"After saving, your account will be linked to your WhatsApp.")))}function ce({onNotice:t}){const[s,m]=i(""),[a,p]=i(!1),[n,y]=i(null),[b,k]=i(null);return React.createElement("div",{className:"space-y-6"},React.createElement("h2",{className:"text-2xl md:text-3xl font-extrabold tracking-tight text-slate-900 dark:text-white drop-shadow-sm"},"Bank Connect"),React.createElement("form",{onSubmit:async u=>{var f,g;u.preventDefault(),p(!0),y(null),k(null);try{const{data:x}=await axios.post(`/api/connect-bank/${s}`);k(x.connectUrl),t==null||t("Connection created. Complete it in Pluggy.")}catch(x){y(((g=(f=x==null?void 0:x.response)==null?void 0:f.data)==null?void 0:g.error)||x.message)}finally{p(!1)}},className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-5 space-y-4 shadow-sm"},React.createElement("div",null,React.createElement("label",{className:"block text-sm text-slate-600 dark:text-slate-300 mb-1"},"Community Currency Address"),React.createElement("input",{value:s,onChange:u=>m(u.target.value),placeholder:"0x...",className:"w-full rounded-md px-3 py-2 text-sm border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})),React.createElement("div",{className:"flex items-center gap-3"},React.createElement("button",{disabled:a,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-emerald-500 text-white text-sm hover:opacity-95 disabled:opacity-50 shadow"},a?"Creating\u2026":"Create Connection"),n&&React.createElement("span",{className:"text-sm text-red-600 dark:text-red-300"},n))),b&&React.createElement("div",{className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-5 shadow-sm"},React.createElement("div",{className:"text-sm text-slate-700 dark:text-slate-200"},"Open this link to complete connection:"),React.createElement("a",{href:b,target:"_blank",className:"text-blue-700 dark:text-blue-300 hover:underline break-all"},b)),React.createElement("div",{className:"backdrop-blur bg-white/70 dark:bg-slate-900/50 border border-white/40 dark:border-slate-800 rounded-xl p-5 shadow-sm"},React.createElement(Z,{initialTokenAddress:s})))}window.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("root");t&&window.ReactDOM&&window.ReactDOM.createRoot(t).render(React.createElement(oe))});function Z({initialTokenAddress:t=""}){const[s,m]=i(t||""),[a,p]=i(""),[n,y]=i(""),[b,k]=i(""),[v,u]=i(window.CONNECTED_ADDRESS||""),[f,g]=i("");D(()=>{function w(N){var e;u(((e=N==null?void 0:N.detail)==null?void 0:e.address)||"")}return window.addEventListener("wallet:changed",w),()=>window.removeEventListener("wallet:changed",w)},[]),D(()=>{t&&m(t)},[t]);async function x(){var w,N;try{if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error("Provide a valid token address");if(!a)throw new Error("Enter your PIX key");if(!/^0x[a-fA-F0-9]{40}$/.test(v))throw new Error("Connect a wallet first");await axios.post("/api/pix/link",{tokenAddress:s,pixKey:a,wallet:v}),g("PIX key linked. Deposits to the connected bank account will auto\u2011mint to your wallet.")}catch(e){g(`Link failed: ${((N=(w=e==null?void 0:e.response)==null?void 0:w.data)==null?void 0:N.error)||e.message}`)}}async function P(){var w,N;try{if(!/^0x[a-fA-F0-9]{40}$/.test(s))throw new Error("Provide a valid token address");if(!n)throw new Error("Enter destination PIX key");if(!b||Number(b)<=0)throw new Error("Enter redeem amount");await axios.post(`/api/tokens/${s}/redeem`,{pixKey:n,amount:b}),g("Redemption initiated. After PIX is sent, tokens are burned.")}catch(e){g(`Redeem failed: ${((N=(w=e==null?void 0:e.response)==null?void 0:w.data)==null?void 0:N.error)||e.message}`)}}return React.createElement("div",{className:"max-w-2xl mx-auto mt-8 p-6 rounded-xl shadow-lg bg-white/70 dark:bg-slate-800/60 backdrop-blur"},React.createElement("h2",{className:"text-xl font-semibold mb-4"},"PIX Deposit \u2192 Auto\u2011Mint, and Redeem \u2192 BRL"),React.createElement("label",{className:"block text-sm mb-1"},"Token Address"),React.createElement("input",{value:s,onChange:w=>m(w.target.value),placeholder:"0x...",className:"w-full p-2 border rounded mb-3 text-slate-900"}),React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},React.createElement("div",null,React.createElement("h3",{className:"font-medium mb-2"},"Link PIX to Your Wallet"),React.createElement("input",{value:a,onChange:w=>p(w.target.value),placeholder:"Your PIX key",className:"w-full p-2 border rounded mb-2 text-slate-900"}),React.createElement("button",{onClick:x,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white py-2 rounded"},"Link PIX \u2192 Auto\u2011Mint"),React.createElement("p",{className:"text-xs mt-2 opacity-80"},"After linking, deposits to the token\u2019s connected bank account that reference your PIX key will be auto\u2011minted (admin mints then transfers) to your connected wallet.")),React.createElement("div",null,React.createElement("h3",{className:"font-medium mb-2"},"Redeem Tokens to BRL"),React.createElement("input",{value:n,onChange:w=>y(w.target.value),placeholder:"PIX key to receive BRL",className:"w-full p-2 border rounded mb-2 text-slate-900"}),React.createElement("input",{type:"number",value:b,onChange:w=>k(w.target.value),placeholder:"Amount",className:"w-full p-2 border rounded mb-2 text-slate-900"}),React.createElement("button",{onClick:P,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded"},"Redeem \u2192 Send BRL via PIX"),React.createElement("p",{className:"text-xs mt-2 opacity-80"},"Transfer tokens to the redemption wallet if prompted. Backend sends PIX then burns tokens."))),React.createElement("div",{className:"mt-3 text-sm min-h-[1.5rem]"},f))}function me(){const[t,s]=i(""),[m,a]=i(""),[p,n]=i(null),[y,b]=i(""),k=window.CONNECTED_ADDRESS||"";async function v(){var u,f;try{if(!k)throw new Error("Connect a wallet first");const g={name:t,symbol:m,masterMinter:k,pauser:k,blacklister:k,owner:k},x=await axios.post("/api/deploy-token",g);n(x.data);const P=await axios.post(`/api/connect-bank/${x.data.proxy}`);b(P.data.connectUrl)}catch(g){alert(((f=(u=g==null?void 0:g.response)==null?void 0:u.data)==null?void 0:f.error)||g.message)}}return React.createElement("div",{className:"space-y-3"},React.createElement("input",{className:"w-full p-2 border rounded text-slate-900",placeholder:"Token Name",value:t,onChange:u=>s(u.target.value)}),React.createElement("input",{className:"w-full p-2 border rounded text-slate-900",placeholder:"Symbol",value:m,onChange:u=>a(u.target.value)}),React.createElement("button",{onClick:v,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded"},"Deploy Token"),p&&React.createElement("div",{className:"p-3 bg-slate-100 dark:bg-slate-700 rounded"},React.createElement("div",null,"Token: ",React.createElement("code",null,p.proxy)),y&&React.createElement("a",{className:"text-blue-600",href:y,target:"_blank",rel:"noreferrer"},"Connect Bank Account")))}function ue(){const[t,s]=i("dashboard");return D(()=>{const a=(location.hash||"").replace("#","");(a==="make"||a==="bank"||a==="dashboard")&&s(a);const p=()=>{const n=(location.hash||"").replace("#","");n&&s(n)};return window.addEventListener("hashchange",p),()=>window.removeEventListener("hashchange",p)},[]),React.createElement("div",{className:"max-w-6xl mx-auto mt-6 grid grid-cols-12 gap-6"},React.createElement("aside",{className:"col-span-12 md:col-span-3"},React.createElement("div",{className:"p-3 rounded-2xl bg-slate-900/5 dark:bg-slate-800/80"},React.createElement("div",{className:"flex flex-col gap-2"},[{id:"dashboard",label:"Dashboard",icon:"\u{1F3E0}"},{id:"make",label:"Make Moeda",icon:"\u{1F680}"},{id:"bank",label:"Bank Connect",icon:"\u{1F3E6}"}].map(a=>React.createElement("button",{key:a.id,onClick:()=>{s(a.id),location.hash=a.id},className:(t===a.id?"bg-indigo-600 text-white shadow":"bg-slate-100 text-slate-900 dark:bg-slate-700 dark:text-slate-100 hover:bg-slate-200 dark:hover:bg-slate-600")+" px-4 py-3 rounded-xl text-left flex items-center gap-3 transition"},React.createElement("span",{className:"text-lg"},a.icon),React.createElement("span",{className:"font-medium"},a.label)))))),React.createElement("main",{className:"col-span-12 md:col-span-9"},t==="dashboard"&&React.createElement("div",{className:"p-5 rounded-2xl bg-white/70 dark:bg-slate-800/60 backdrop-blur"},React.createElement("h2",{className:"text-lg font-semibold mb-2"},"Dashboard"),React.createElement("p",{className:"opacity-80"},"Overview coming soon. Use Make Moeda to deploy a token or Bank Connect to link your PIX and redeem.")),t==="make"&&React.createElement("div",{className:"p-5 rounded-2xl bg-white/70 dark:bg-slate-800/60 backdrop-blur"},React.createElement("h2",{className:"text-lg font-semibold mb-3"},"\u{1F680} Make Moeda"),React.createElement(me,null)),t==="bank"&&React.createElement("div",{className:"p-5 rounded-2xl bg-white/70 dark:bg-slate-800/60 backdrop-blur"},React.createElement("h2",{className:"text-lg font-semibold mb-3"},"\u{1F3E6} Bank Connect"),React.createElement(Z,null))))}const V=document.getElementById("app-menu");V&&ReactDOM.createRoot(V).render(React.createElement(ue));})();
